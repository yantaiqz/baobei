# China Life & Death | 生死观测台
![项目图标](☯️)

## 项目简介
这是一款基于 **Streamlit** + **PyDeck** 开发的中国人口动态模拟可视化应用，以暗黑高对比度风格呈现全国31个省份/直辖市的实时人口新生与离世数据，支持中英双语无缝切换、地理空间可视化、数据统计看板及打赏支持功能。

### 核心特色
1.  **双地图实时可视化**：左侧展示新生人口分布（蓝/紫标记），右侧展示离世人口分布（红标记），基于暗黑底图提升视觉冲击力
2.  **高对比度UI设计**：符合WCAG无障碍标准，纯白/亮绿/亮红配色确保文字与元素清晰可辨，适配弱视觉用户
3.  **中英双语全适配**：所有界面元素、提示文本、统计信息均支持中英文切换，无功能遗漏
4.  **多维度数据统计**：包含会话内总新生/离世数、实时日志流、省级TOP10数据看板（带进度条可视化）
5.  **数据自动清理与持久化**：地图标记自动过期清理，访问PV数据持久化存储于SQLite数据库
6.  **便捷打赏功能**：支持微信、支付宝、PayPal三种支付方式，预设快捷打赏金额，附带成功动画与提示

## 支持的省份/地区
覆盖中国31个省级行政区（含省、自治区、直辖市），每个地区均配置：
- 中英双语名称
- 地理坐标（纬度/经度）
- 人口权重（影响新生/离世事件生成概率，基于实际人口规模设定）

| 部分省级行政区示例 | 英文名称 | 地理坐标 | 人口权重 |
|--------------------|----------|----------|----------|
| 广东 | Guangdong | 23.1°N, 113.2°E | 126 |
| 山东 | Shandong | 36.6°N, 117.0°E | 101 |
| 北京 | Beijing | 39.9°N, 116.4°E | 21 |
| 上海 | Shanghai | 31.2°N, 121.4°E | 24 |
| 西藏 | Tibet | 29.6°N, 91.1°E | 3 |

## 环境准备
### 依赖库安装
```bash
pip install streamlit pydeck pandas sqlite3 datetime os time random
```
> 说明：`sqlite3`、`datetime`、`os`、`time`、`random` 为Python内置库，通常无需额外安装，重点安装 `streamlit`、`pydeck`、`pandas` 三个第三方库。

### 目录结构（可选）
```
├── 项目根目录
│   ├── wechat_pay.jpg （可选）微信收款码本地图片
│   ├── ali_pay.jpg    （可选）支付宝收款码本地图片
│   ├── paypal.png     （可选）PayPal收款码本地图片
│   └── life_death_sim.py  # 核心代码文件
```
> 提示：本地收款码图片非必需，无本地图片时会自动生成在线二维码。

## 运行步骤
1.  将核心代码保存为 `life_death_sim.py`
2.  在终端切换至脚本所在目录
3.  执行运行命令：
    ```bash
    streamlit run life_death_sim.py
    ```
4.  自动打开浏览器，访问 `http://localhost:8501` 即可进入应用界面

## 功能使用指南
### 1. 基础界面操作
- **语言切换**：页面顶部右侧点击「🌐 EN」/「🌐 中」，一键切换中英双语界面，所有数据与文本实时同步更新
- **更多应用**：页面顶部右侧点击「更多应用 ↗」/「More Apps ↗」，跳转至开发者其他应用集合
- **界面布局**：顶部为HUD仪表盘（应用标题+副标题），中间为双地图可视化区域，下方为数据统计看板与功能展开栏

### 2. 数据查看与解读
- **双地图可视化**：
  - 左侧「新生地图」：蓝点代表男婴，紫点代表女婴，点的大小对应固定权重，地图支持缩放、平移、俯仰操作
  - 右侧「离世地图」：红点代表居民离世，地图操作与左侧一致，可对比两地人口动态分布
- **实时日志流**：
  - 中间左侧为新生日志，按时间倒序展示最新6条新生记录，包含时间、地区、婴儿性别
  - 中间右侧为离世日志，按时间倒序展示最新6条离世记录，包含时间、地区
- **统计数字**：
  - 左侧高亮绿色数字为「本场新生」总数
  - 右侧高亮红色数字为「本场离世」总数
- **省级数据看板**：
  - 点击「📊 各省数据监控看板」/「📊 Provincial Statistics」展开栏，查看TOP10省份的新生/离世数据
  - 数据以进度条形式呈现，按总事件数（新生+离世）排序，支持中英文列名切换，隐藏索引列更简洁

### 3. 打赏功能操作
1.  点击页面下方「请开发者喝咖啡」/「Buy me a coffee」展开栏（默认收起）
2.  选择快捷打赏金额：「☕ 1」、「🍗 3」、「🚀 5」，或在输入框自定义打赏杯数（1-100之间）
3.  选择支付方式：切换「微信支付」/「Alipay」/「PayPal」三个标签页
4.  支付操作：
    - 微信/支付宝：扫码完成支付（本地图片优先，无本地图片显示在线生成二维码）
    - PayPal：点击「👉 Pay $XXX」按钮，跳转至PayPal在线支付页面
5.  支付确认：点击「🎉 收到！」/「🎉 Received!」按钮，触发气球动画与成功提示，3秒后提示自动消失

### 4. 数据生命周期说明
- **会话内数据**：新生/离世总数、省级统计、日志流、地图标记均存储于Streamlit `session_state`，仅在当前会话有效（关闭浏览器/刷新页面后重置）
- **自动数据清理**：地图标记每5个刷新周期（约4秒）清理一次，仅保留最近3秒内的标记，避免页面卡顿
- **持久化数据**：访问PV数据存储于用户根目录的 `baby_map.db` SQLite数据库，按日期记录，不会随会话结束丢失

## 核心参数说明（可自定义修改）
在代码中可调整以下参数，修改应用运行效果：
```python
REFRESH_RATE = 0.8  # 数据刷新间隔（秒），越小刷新越频繁
BIRTH_PROB = 0.6    # 每次刷新生成新生事件的概率（0-1之间）
DEATH_PROB = 0.5    # 每次刷新生成离世事件的概率（0-1之间）
CLEAN_INTERVAL = 5  # 地图数据清理间隔（刷新周期数）
```

## 注意事项
1.  本应用为**模拟演示项目**，所有人口动态数据均为随机生成，不代表真实人口统计数据，仅供技术展示与学习使用
2.  地图可视化依赖PyDeck插件，若加载失败请检查网络连接或更新PyDeck版本
3.  持久化数据库文件存储于用户根目录（`~/baby_map.db`），如需清除访问统计数据，可直接删除该文件
4.  打赏功能仅为展示用途，无实际支付校验逻辑，扫码支付后点击确认仅触发前端动画效果
5.  应用运行过程中请勿频繁刷新页面，避免数据统计异常与资源占用过高

## 界面风格说明
1.  整体采用暗黑沉浸式风格（背景色 `#0e1117`），减少视觉疲劳，突出数据可视化效果
2.  文字与元素采用高对比度配色，确保无障碍访问：
    - 主文字：纯白（`#ffffff`），对比度15:1+
    - 新生数据：亮绿（`#4ade80`），对比度8:1+
    - 离世数据：亮红（`#f87171`），对比度7:1+
    - 链接与按钮：亮蓝（`#60a5fa`），对比度7:1+
3.  日志流采用遮罩渐变效果，隐藏底部溢出内容，提升界面整洁度
4.  所有按钮、输入框、展开栏均做样式优化，适配暗黑主题，无视觉冲突
